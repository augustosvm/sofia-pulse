#!/bin/bash
# ============================================================================
# SOFIA PULSE - RUN EVERYTHING AND EMAIL
# ============================================================================
# Script MASTER que faz TUDO:
# 1. Coleta TODOS os dados (30+ fontes)
# 2. Gera TODAS as anรกlises (10+ relatรณrios)
# 3. Envia email COMPLETO com tudo
#
# Tempo estimado: 25-30 minutos
# ============================================================================

set -e

SOFIA_DIR="/home/ubuntu/sofia-pulse"
[ -d "$SOFIA_DIR" ] || SOFIA_DIR="$(pwd)"
cd "$SOFIA_DIR"

echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "๐ SOFIA PULSE - MASTER EXECUTION"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""
echo "Este script vai executar TUDO:"
echo "  ๐ Coleta de dados (30+ fontes)"
echo "  ๐ Anรกlises completas (10+ relatรณrios)"
echo "  ๐ง Email com TODOS os anexos"
echo ""
echo "โฑ๏ธ  Tempo estimado: 25-30 minutos"
echo ""
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""

read -p "Deseja continuar? (y/n) " -n 1 -r
echo
if [[ ! $REPLY =~ ^[Yy]$ ]]
then
    echo "โ Execuรงรฃo cancelada"
    exit 1
fi

echo ""
START_TIME=$(date +%s)

# ============================================================================
# PHASE 1: COLLECTION (30+ sources)
# ============================================================================

echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "๐ PHASE 1: MEGA COLLECTION"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""

bash run-mega-collection.sh

COLLECTION_TIME=$(date +%s)
COLLECTION_ELAPSED=$((COLLECTION_TIME - START_TIME))

echo ""
echo "โ Collection complete! Time: ${COLLECTION_ELAPSED}s"
echo ""

# ============================================================================
# PHASE 2: ANALYTICS (10+ reports)
# ============================================================================

echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "๐ PHASE 2: MEGA ANALYTICS"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""

bash run-mega-analytics.sh

ANALYTICS_TIME=$(date +%s)
ANALYTICS_ELAPSED=$((ANALYTICS_TIME - COLLECTION_TIME))

echo ""
echo "โ Analytics complete! Time: ${ANALYTICS_ELAPSED}s"
echo ""

# ============================================================================
# PHASE 3: EMAIL
# ============================================================================

echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "๐ง PHASE 3: SEND EMAIL"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""

bash send-email-mega.sh

EMAIL_TIME=$(date +%s)
EMAIL_ELAPSED=$((EMAIL_TIME - ANALYTICS_TIME))

echo ""
echo "โ Email sent! Time: ${EMAIL_ELAPSED}s"
echo ""

# ============================================================================
# SUMMARY
# ============================================================================

END_TIME=$(date +%s)
TOTAL_ELAPSED=$((END_TIME - START_TIME))
MINUTES=$((TOTAL_ELAPSED / 60))
SECONDS=$((TOTAL_ELAPSED % 60))

echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "โ MASTER EXECUTION COMPLETE!"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""
echo "โฑ๏ธ  Total Time: ${MINUTES}m ${SECONDS}s"
echo ""
echo "๐ Phase Breakdown:"
echo "   โข Collection: ${COLLECTION_ELAPSED}s (~$(( COLLECTION_ELAPSED / 60 ))m)"
echo "   โข Analytics:  ${ANALYTICS_ELAPSED}s (~$(( ANALYTICS_ELAPSED / 60 ))m)"
echo "   โข Email:      ${EMAIL_ELAPSED}s (~$(( EMAIL_ELAPSED / 60 ))m)"
echo ""
echo "๐ง Email Details:"
echo "   โข Destinatรกrio: augustosvm@gmail.com"
echo "   โข Relatรณrios: 10+ arquivos TXT"
echo "   โข CSVs: 15+ arquivos de dados RAW"
echo "   โข Total anexos: ~25+ arquivos"
echo ""
echo "๐ Data Summary:"
echo "   โข Fontes de dados: 30+"
echo "   โข Registros analisados: ~150,000+"
echo "   โข Paรญses cobertos: 200+"
echo "   โข Indicadores socioeconรดmicos: 56"
echo "   โข Perรญodo temporal: 2015-2024"
echo ""
echo "๐ฏ Next Steps:"
echo "   1. Checar seu email: augustosvm@gmail.com"
echo "   2. Baixar anexos (relatรณrios TXT + CSVs)"
echo "   3. Ler MEGA-ANALYSIS.txt primeiro (visรฃo geral)"
echo "   4. Explorar relatรณrios especรญficos conforme interesse"
echo ""
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "๐ Sofia Pulse Intelligence System - Execution Complete!"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
